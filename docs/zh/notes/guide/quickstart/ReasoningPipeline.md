---

title: 强推理数据合成流水线
icon: mdi:brain
createTime: 2025/06/16 13:08:42
permalink: /zh/guide/reasoningpipeline/

---

# 强推理数据合成流水线

## 1. 概述

**强推理数据合成流水线**的核心目标是通过数学问答数据的合成和处理，增强现有数据集的规模与多样性，进而为模型调优提供更丰富的训练数据。该流水线通过多个处理步骤（如问题过滤、问题合成、答案生成与验证等），将原始的数学问题数据转化为高质量的问答数据，并且对生成的问答数据进行分类、难度评分和去重，最终形成适用于各种推理任务的数据集。

流水线的主要流程如下：

1. **问题处理**：包括过滤非数学问题、合成新的数学问题、对问题进行正确性验证、难度评分以及类别分类。
2. **答案生成与处理**：根据问题的标准答案或通过模型生成的答案进行处理，包括格式过滤、长度过滤、正确性验证等。
3. **数据去重**：对生成的问答数据进行去重处理，确保数据集的质量。

## 2. 数据流与流水线逻辑

该流水线的整体运作遵循以下步骤：

1. **问题输入与过滤**：流水线首先接受一组数学问题数据，并通过**问题过滤器**（QuestionFilter）剔除非数学问题和不符合要求的错误问题。这一步骤对于问题合成尤为重要，因为它能避免模型基于错误问题合成更多错误问题。

2. **问题合成与标记**：在合适的问题数据基础上，流水线通过**问题合成**（QuestionGenerator）算子生成新的数学问题，随后再进行一次过滤以确保问题的正确性。此外，合成的问题将按照**难度**和**类别**进行标记，这有助于最终数据的分析和分布理解。

3. **答案生成**：如果原始数据中包含标准答案（golden answer），流水线将通过**答案生成**（AnswerGenerator）算子生成高质量的推理过程。如果没有标准答案，则通过多次模型回答并投票选择一个最可能的答案作为“伪答案”（pseudo answer）。

4. **答案验证与处理**：在生成答案后，流水线对答案进行格式过滤、长度过滤以及准确性验证。最终，根据实际情况选择是否对答案进行去重处理，确保输出的数据不含重复或无效的答案。

## 3. 适用数据

该流水线主要适用于以下几种数据场景：

* **问题 + 标准答案（golden answer）**：如果原始数据已经包含标准答案，流水线将通过标准答案生成与之相符的推理过程。

* **问题 + 解答（solution）**：如果数据仅包含问题和已有解答，流水线通过模型生成更多可能的推理过程并验证解答的准确性。

* **只有问题**：对于仅包含问题的场景，流水线将从问题生成更多样的推理过程，并最终为这些问题生成合适的答案。

* **混合场景**：数据可能同时包含标准答案和解答等多个信息，流水线支持对这些信息进行综合处理，生成一个完整的数据集。

## 4. 运行方式

该流水线支持通过简单的脚本执行不同的配置，以适应不同的数据需求：

* **含标准答案的场景**：

  ```bash
  bash ReasoningPipeline/pipeline_GT.sh
  ```

* **不含标准答案的场景**：

  ```bash
  bash ReasoningPipeline/pipeline_withoutGT.sh
  ```

* **混合场景**：

  ```bash
  bash ReasoningPipeline/pipeline_full.sh
  ```

* **大规模预训练数据合成**：

  ```bash
  bash ReasoningPipeline/pipeline_Pretrain.sh
  ```

这些脚本将依次执行对应的流水线步骤，并生成所需的中间文件和结果数据。

## 5. 数据格式

### 5.1 输入数据

输入数据支持`json`和`jsonl`格式。每个数据项必须包含以下字段：

* **instruction**：问题文本
* **golden\_answer**：标准答案（如果有）
* **solution**：已有解答或推理过程（如果有）

### 5.2 输出数据

输出数据格式为`jsonl`，每个步骤都会生成一个输出文件，包含以下字段：

* **instruction**：问题
* **generated\_cot**：模型生成的长链推理过程
* **output**：模型生成的解答
* **golden\_answer**：标准答案
* **Synth\_or\_Input**：标识原始数据（`input`）或合成数据（`synth`）
* **Difficulty**：难度评分（0–10）
* **primary\_category**：问题的主要类别
* **secondary\_category**：问题的次要类别